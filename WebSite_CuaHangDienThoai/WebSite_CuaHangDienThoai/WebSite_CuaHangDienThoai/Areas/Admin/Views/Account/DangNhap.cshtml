@model WebSite_CuaHangDienThoai.Models.tb_Staff
@{
    ViewBag.Title = "DangNhap";
}

<link href="https://fonts.googleapis.com/css?family=Lato:300,400,700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link href="~/Content/Css/Addmin/Login.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> <!-- SweetAlert2 -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="~/Scripts/Admin/Login/js/popper.js"></script>
<script src="~/Scripts/Admin/Login/js/bootstrap.min.js"></script>
<script src="~/Scripts/Admin/Login/js/main.js"></script>













@*====================End JS Temp Tesst====================*@







@using (Html.BeginForm("DangNhap", "Account", FormMethod.Post, new { id = "loginForm" }))
{
    @Html.AntiForgeryToken()

    <body class="img js-fullheight" style="background-image: url(images/bg.jpg); background-color: #3e3e3f">
        <section class="ftco-section">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-md-6 text-center mb-5">
                        <h1 class="heading-section"> <a href="/home/index" style="color: red; font-family: Poppins-Regular; ">LTD<span style="color: white; font-family: Poppins-Regular; ">MiniStore</span></a></h1>
                    </div>
                </div>
                <div class="row justify-content-center">
                    <div class="col-md-8 col-lg-4">
                        <div class="login-wrap p-0">
                            <h3 class="mb-6 text-center">Hệ thống đang nhập nhân viên</h3>
                            <div id="errorMessage" class="mb-3 text-center" style="color: red;"></div>
                            <div class="form-group">
                                <label class="form-label" for="form3Example4c" style="font-family: Poppins-Regular; font-size: 22px;">Mã số nhân viên</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-person-fill" viewBox="0 0 16 16">
                                            <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6" />
                                        </svg>
                                    </span>
                                    @Html.TextBoxFor(m => m.Code, "", new { @class = "form-control", @placeholder = "Nhập mã số nhân viên", style = "border: none;" })
                                </div>
                            </div>
                            <label class="form-label" for="form3Example4c" style="font-family: Poppins-Regular; font-size: 22px;">Mật khẩu/Password</label>
                            <div class="form-group">

                                <div class="input-group">
                                    <span class="input-group-text">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-file-earmark-lock2-fill" viewBox="0 0 16 16">
                                            <path d="M7 7a1 1 0 0 1 2 0v1H7z" />
                                            <path d="M9.293 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.707A1 1 0 0 0 13.707 4L10 .293A1 1 0 0 0 9.293 0M9.5 3.5v-2l3 3h-2a1 1 0 0 1-1-1M10 7v1.076c.54.166 1 .597 1 1.224v2.4c0 .816-.781 1.3-1.5 1.3h-3c-.719 0-1.5-.484-1.5-1.3V9.3c0-.627.46-1.058 1-1.224V7a2 2 0 1 1 4 0" />
                                        </svg>
                                    </span>
                                    @Html.PasswordFor(m => m.Password, new { @class = "form-control", @placeholder = "Mật khẩu", id = "password-field", required = "required" })
                                </div>
                                <span toggle="#password-field" class="fa fa-fw fa-eye field-icon toggle-password" style="color:black; cursor: pointer;"></span>

                            </div>
                            <div class="form-group">
                                <button type="submit" class="form-control btn btn-success submit px-3" style="background: #57b846;color:white">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-box-arrow-in-right" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M6 3.5a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0z" />
                                        <path fill-rule="evenodd" d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z" />
                                    </svg>
                                    Đăng nhập
                                </button>
                            </div>
                            <div class="form-group d-md-flex">
                              
                                <div class="w-100 text-center">
                                    <h6 class="" style="color: #fff">Bạn quên mật khẩu? liên hệ quản lý  <a href="#" style="color: red">Tại đây !</a></h6>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </body>
}

<script>


    $(document).ready(function () {
        $(".toggle-password").click(function () {
            var input = $($(this).attr("toggle"));
            if (input.attr("type") === "password") {
                input.attr("type", "text");
                $(this).addClass("fa-eye-slash");
            } else {
                input.attr("type", "password");
                $(this).removeClass("fa-eye-slash");
            }
        });
    });
    $(document).ready(function () {
        $('#loginForm').submit(function (e) {
            e.preventDefault(); // Ngăn chặn việc submit form mặc định

            // Gửi dữ liệu form đi bằng AJAX
            $.ajax({
                url: $(this).attr('action'),
                type: 'POST',
                data: $(this).serialize(), // Serialize dữ liệu form
                success: function (response) {
                    if (response.success) {
                        // Thành công, redirect hoặc thực hiện hành động cần thiết
                        if (response.redirectUrl) {
                            window.location.href = response.redirectUrl;
                        }
                    } else {
                        // Hiển thị thông báo lỗi
                        Swal.fire({
                            icon: 'error',
                            title: 'Đăng nhập thất bại',
                            text: getErrorMessage(response.code),
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'OK'
                        });
                    }
                },
                error: function () {
                    // Hiển thị thông báo lỗi
                    Swal.fire({
                        icon: 'error',
                        title: 'Lỗi',
                        text: 'Đã xảy ra lỗi khi đăng nhập.',
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'OK'
                    });
                }
            });
        });

        // Hàm lấy thông báo lỗi từ mã code
        function getErrorMessage(code) {
            switch (code) {
                case -1:
                    return 'Chức năng không hợp lệ';
                case -2:
                    return 'Không tìm thấy chức năng của tài khoản';
                case -3:
                    return 'Tài khoản đã bị khóa';
                case -4:
                    return 'Tài khoản hoặc mật khẩu không đúng';
                case -5:
                    return 'Dữ liệu không hợp lệ';
                default:
                    return 'Đã xảy ra lỗi khi đăng nhập.';
            }
        }
    });

</script>
